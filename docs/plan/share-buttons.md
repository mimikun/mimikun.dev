# シェアボタン実装計画

## 概要

ソーシャルメディア依存のシェアボタンから汎用的なクリップボードコピー機能への移行を段階的に実装する。

## 実装フェーズ

### フェーズ 1: 基本実装

- [ ] **CopyShareButton.astroコンポーネント作成**
  - [ ] ファイル作成: `src/components/CopyShareButton.astro`
  - [ ] Props定義: `title: string`
  - [ ] 基本HTMLマークアップ
  - [ ] クリップボードアイコンのSVG追加

- [ ] **基本的なクリップボード機能実装**
  - [ ] `navigator.clipboard.writeText()`実装
  - [ ] `define:vars`でサーバーサイドデータ渡し
  - [ ] コピー内容フォーマット: `${title} - ${siteName}\n${url}`

- [ ] **PostDetails.astroの修正**
  - [ ] ShareLinksのコメントアウト
  - [ ] CopyShareButtonのimport追加
  - [ ] CopyShareButtonコンポーネント配置

### フェーズ 2: ユーザーエクスペリエンス向上

- [ ] **視覚的フィードバック実装**
  - [ ] 成功時のチェックマークアイコン表示
  - [ ] 失敗時の×マークアイコン表示
  - [ ] 2秒後の元アイコンへの復帰
  - [ ] アイコンの色変更（緑/赤）

- [ ] **エラーハンドリング強化**
  - [ ] try-catch構文実装
  - [ ] ユーザー向けエラーメッセージ
  - [ ] console.errorでのデバッグログ

- [ ] **アクセシビリティ対応**
  - [ ] `sr-only`クラスでスクリーンリーダー対応
  - [ ] ボタンのaria-label設定
  - [ ] キーボードナビゲーション確認

### フェーズ 3: スタイリング・統合

- [ ] **デザインシステム統合**
  - [ ] 既存のShareLinksと同じレイアウト適用
  - [ ] TailwindCSSクラス統一
  - [ ] ホバー効果: `hover:rotate-6`
  - [ ] レスポンシブデザイン確認

- [ ] **AstroPaperテーマとの統合**
  - [ ] ライト/ダークモード対応確認
  - [ ] 既存のfocus-outlineクラス適用
  - [ ] アイコンサイズとスタイル統一

### フェーズ 4: テスト・検証

- [ ] **機能テスト**
  - [ ] クリップボードコピー動作確認
  - [ ] コピー内容の形式検証
  - [ ] 成功フィードバックの動作確認
  - [ ] 失敗フィードバックの動作確認

- [ ] **ブラウザ互換性テスト**
  - [ ] Chrome (最新版)
  - [ ] Firefox (最新版)
  - [ ] Safari (最新版)
  - [ ] Edge (最新版)

- [ ] **環境テスト**
  - [ ] localhost:4321 (開発環境)
  - [ ] HTTPS本番環境
  - [ ] HTTP環境でのエラーハンドリング確認

### フェーズ 5: 最終調整・ドキュメント

- [ ] **コード品質確保**
  - [ ] ESLint実行・修正
  - [ ] Prettier実行・フォーマット
  - [ ] TypeScript型チェック

- [ ] **ドキュメント更新**
  - [ ] 実装完了の記録
  - [ ] 使用方法の説明追加
  - [ ] トラブルシューティング情報

- [ ] **クリーンアップ**
  - [ ] 不要なコメント削除
  - [ ] 未使用import削除
  - [ ] コンソールログの削除

## 進捗記録

### 完了済み
- ✅ アイデア文書作成 (`docs/idea/share-buttons.md`)
- ✅ 設計書作成 (`docs/design/share-buttons.md`)
- ✅ 実装計画作成 (この文書)

### 現在作業中
- 🔄 なし（次回作業開始時に更新）

### 次回作業予定
- 📝 CopyShareButton.astroの基本実装

## 実装メモ

### 技術的考慮事項
- Clipboard APIはHTTPS必須
- `define:vars`でサーバー側データをクライアント側に渡す
- 既存のコードコピー機能(PostDetails.astro:232-271)を参考にする

### upstream追従性
- ShareLinksコンポーネントは完全保持
- PostDetails.astroの変更は最小限(1行のコメントアウト + 1行の追加)
- 新規ファイルのみ追加で既存ファイルの削除なし

### 設定値
- サイト名: `SITE.title` = "mimikun.dev"
- 記事タイトル: PostDetails.astroの`title`変数
- URL: `window.location.href`

## トラブルシューティング

### 想定される問題
1. **Clipboard APIが動作しない**
   - 原因: HTTP環境、ブラウザ未対応
   - 対策: エラーハンドリングで視覚的フィードバック

2. **SVGアイコンが表示されない**
   - 原因: パス間違い、TailwindCSSクラス問題
   - 対策: 既存アイコンのクラス構成を参考

3. **upstream追従時のコンフリクト**
   - 原因: PostDetails.astroの変更箇所
   - 対策: コメント形式で元コードを保持

## 完了条件

- [ ] 全フェーズのチェックボックスが完了
- [ ] 本番環境での動作確認完了
- [ ] ESLint・Prettier・TypeScript全てPass
- [ ] 主要ブラウザでの動作確認完了

---

**最終更新**: 2025-07-12
**ステータス**: 実装計画策定完了・実装準備中