# Fish用 zeno PIDエラー解決策

## 概要
Fish shellでzeno.zshを使用中に「zeno: Failed to get server PID」エラーが発生した場合の対処法を番号順に整理しました。

## 解決策リスト

### **1. CLIモードに切り替え（Fish版）**
```fish
set -gx ZENO_DISABLE_SOCK 1
```
**効果**: ソケットモードを無効化し、CLIモードで動作  
**適用**: 即座に効果あり  
**永続性**: セッション中のみ

### **2. Fish設定ファイルに恒久対策**
```fish
echo "set -gx ZENO_DISABLE_SOCK 1" >> ~/.config/fish/config.fish
```
**効果**: 設定を永続化、次回起動時から自動適用  
**適用**: 次回Fish起動時から  
**永続性**: 永続的

### **3. Fish手動サーバー起動**
```fish
nohup /home/mimikun/.local/share/zeno.zsh/bin/zeno-server > /dev/null 2>&1 &
```
**効果**: サーバーを手動で起動してソケットモードを復活  
**適用**: 即座  
**永続性**: プロセス終了まで

### **4. Fishソケットファイル削除・再起動**
```fish
rm -f /run/user/1000/zeno-mimikun/*.sock
```
**効果**: 残存する問題のあるソケットファイルを削除  
**適用**: 即座  
**永続性**: 削除後は問題解決

### **5. Fish権限修正**
```fish
chmod 755 /run/user/1000/zeno-mimikun/
```
**効果**: ソケットディレクトリの権限問題を解決  
**適用**: 即座  
**永続性**: 永続的

### **6. Fish環境変数確認**
```fish
echo "ZENO_ROOT: $ZENO_ROOT"
echo "ZENO_SOCK: $ZENO_SOCK"
```
**効果**: 設定状況の確認（トラブルシュート用）  
**適用**: 即座  
**永続性**: 確認のみ

### **7. Fishデバッグモード有効化**
```fish
set -gx ZENO_LOG_LEVEL debug
```
**効果**: 詳細なログ出力でエラー原因を特定  
**適用**: 即座  
**永続性**: セッション中のみ

### **8. Fish全環境変数リセット**
```fish
set -e ZENO_SOCK ZENO_PID ZENO_SERVER_PID
```
**効果**: 壊れた環境変数をクリア  
**適用**: 即座  
**永続性**: セッション中のみ

### **9. Fish設定再読み込み**
```fish
source ~/.config/fish/config.fish
```
**効果**: 設定変更を現在のセッションに反映  
**適用**: 即座  
**永続性**: セッション中

### **10. Fishセッション再起動**
```fish
exec fish
```
**効果**: Fishを完全に再起動して環境をリセット  
**適用**: 即座  
**永続性**: 新しいセッションで継続

## 推奨実行順序

### **基本対応（最も安全）**
1. **解決策1**: CLIモードに切り替え
2. **解決策2**: 設定ファイルに恒久対策
3. **解決策9**: 設定再読み込み

### **詳細トラブルシュート**
1. **解決策6**: 環境変数確認
2. **解決策4**: ソケットファイル削除
3. **解決策3**: 手動サーバー起動

### **最終手段**
1. **解決策8**: 環境変数リセット
2. **解決策10**: セッション再起動

## 各解決策の特徴

| 番号 | 難易度 | 効果 | リスク | 推奨度 |
|------|--------|------|--------|--------|
| 1    | ★☆☆   | 高   | なし   | ★★★   |
| 2    | ★☆☆   | 高   | なし   | ★★★   |
| 3    | ★★☆   | 中   | 低     | ★★☆   |
| 4    | ★☆☆   | 中   | なし   | ★★☆   |
| 5    | ★☆☆   | 低   | なし   | ★☆☆   |
| 6    | ★☆☆   | なし | なし   | ★★☆   |
| 7    | ★☆☆   | 低   | なし   | ★☆☆   |
| 8    | ★★☆   | 中   | 中     | ★☆☆   |
| 9    | ★☆☆   | 中   | なし   | ★★☆   |
| 10   | ★☆☆   | 高   | なし   | ★★☆   |

## 注意事項

### CLIモード vs ソケットモード
- **CLIモード**: 安定性が高いが、パフォーマンスがやや劣る
- **ソケットモード**: 高速だが、Fish shellで不安定な場合がある

### 設定の永続化
- 一時的な対策（解決策1, 7, 8）は、新しいセッションで無効になる
- 恒久的な対策には解決策2を推奨

### バックアップ
設定ファイルを変更する前に、バックアップを作成することを推奨：
```fish
cp ~/.config/fish/config.fish ~/.config/fish/config.fish.backup
```

## サポート情報

### 環境
- **Shell**: Fish shell
- **Plugin**: zeno.zsh
- **Runtime**: Deno
- **OS**: Linux

### 関連ファイル
- `~/.config/fish/config.fish` - Fish設定ファイル
- `/run/user/1000/zeno-mimikun/` - ソケットディレクトリ
- `/home/mimikun/.local/share/zeno.zsh/` - zeno.zshインストールディレクトリ

---

**作成日**: 2025-10-18  
**対象**: Fish shell + zeno.zsh PIDエラー  
**レベル**: 初級〜中級